"use strict";angular.module("NumidiApp",["ui","ui.bootstrap","LocalStorageModule"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/home.html"}).when("/board",{controller:"BoardController",templateUrl:"views/board.html"}).when("/settings",{controller:"SettingsController",templateUrl:"views/settings.html"}).when("/highscore",{controller:"HighScoreController",templateUrl:"views/highscore.html"}).when("/rules",{templateUrl:"views/rules.html"}).when("/about",{templateUrl:"views/about.html"}).otherwise({redirectTo:"/board"})}]),angular.module("NumidiApp").controller("NavbarController",["$scope","$location",function(a,b){a.routeIs=function(a){return b.path()===a}}]),angular.module("NumidiApp").controller("BoardController",["$scope","$modal","boardService","settingsService","highScoreService",function(a,b,c,d,e){a.board=c,a.settings=d,a.highScore=e,a.pickTile=function(c){function d(c,d){b.open({templateUrl:"name.html",backdrop:"static",windowClass:"modal",scope:a,controller:function(a,b){a.ok=function(){a.highScore.addResult(c,a.settings.name,d),b.close(a.settings.name)}}})}a.board.pickTile(c);var e=a.settings.width,f=a.board.score();a.board.win&&a.highScore.isHighScore(e,f)&&d(e,f)}}]),angular.module("NumidiApp").service("boardService",["settingsService",function(a){function b(a,b,c){this.number=a,this.coordinate=[],this.coordinate.row=b,this.coordinate.col=c,this.picked=!1,this.solved=!1}function c(a,b){var c={row:a.row,col:a.col};return c.col+=1,c.col==d.settings.width&&(c.col=0,c.row+=1),b&&(c.row>d.lastCoordinate.row||c.row==d.lastCoordinate.row&&c.col>d.lastCoordinate.col)&&(c.row=0,c.col=0),c}var d=this;d.settings=a,d.started=!1,d.win=!1,d.grid=[],d.lastCoordinate=[],d.firstPick=void 0,d.resetGame=function(){d.started=!1,d.win=!1,d.grid=[],d.lastCoordinate=[],d.firstPick=void 0},d.newGame=function(){d.resetGame(),d.started=!0,d.grid[0]=[];for(var a=-1,c=0;c<d.settings.width;c++){do var e=Math.floor(10*Math.random());while(a==e||10==a+e);d.grid[0][c]=new b(e,0,c),a=e}d.grid[1]=[];for(var c=0;c<d.settings.width;c++)d.grid[1][c]=new b(c%10,1,c);d.lastCoordinate=[],d.lastCoordinate.row=1,d.lastCoordinate.col=d.settings.width-1},d.score=function(){return d.lastCoordinate.row*d.settings.width+d.lastCoordinate.col+1},d.pickTile=function(a){function b(){for(var a=0;a<=d.lastCoordinate.row;a++)for(var b=0;b<=(a==d.lastCoordinate.row?d.lastCoordinate.col:d.settings.width-1);b++)if(!d.grid[a][b].solved)return!1;return!0}function e(a,b){return f(a.coordinate,b.coordinate)||f(b.coordinate,a.coordinate)||g(a.coordinate,b.coordinate)||h(a.coordinate,b.coordinate)}function f(a,b){var e=c(a,!0);return e.row==b.row&&e.col==b.col?!0:d.grid[e.row][e.col].solved?f(e,b):!1}function g(a,b){if(a.col!=b.col)return!1;for(var c=Math.min(a.row,b.row)+1;c<Math.max(a.row,b.row);c++)if(!d.grid[c][a.col].solved)return!1;return!0}function h(a,b){if(Math.abs(a.row-b.row)!=Math.abs(a.col-b.col)||a.row==b.row)return!1;var c={row:a.row>b.row?a.row-1:a.row+1,col:a.col>b.col?a.col-1:a.col+1};return c.row==b.row&&c.col==b.col?!0:d.grid[c.row][c.col].solved?h(c,b):!1}a.solved?d.firstPick&&(d.firstPick.picked=!1,d.firstPick=void 0):d.firstPick?d.firstPick===a?(a.picked=!1,d.firstPick=void 0):d.firstPick.number!=a.number&&10!=d.firstPick.number+a.number||!e(d.firstPick,a)?(d.firstPick.picked=!1,a.picked=!0,d.firstPick=a):(d.firstPick.picked=!1,d.firstPick.solved=!0,a.picked=!1,a.solved=!0,d.firstPick=void 0,d.win=b()):(a.picked=!0,d.firstPick=a)},d.deal=function(){for(var a={row:d.lastCoordinate.row,col:d.lastCoordinate.col},e=0;e<=a.row;e++)for(var f=0;f<=(e==a.row?a.col:d.settings.width-1);f++)d.grid[e][f].solved||(d.lastCoordinate=c(d.lastCoordinate,!1),0==d.lastCoordinate.col&&(d.grid[d.lastCoordinate.row]=[]),d.grid[d.lastCoordinate.row][d.lastCoordinate.col]=new b(d.grid[e][f].number,d.lastCoordinate.row,d.lastCoordinate.col))}}]),angular.module("NumidiApp").controller("SettingsController",["$scope","settingsService","boardService",function(a,b,c){a.settings=b,a.board=c}]),angular.module("NumidiApp").service("settingsService",function(){var a=this;a.width=20,a.widths=[10,15,20,25,30],a.showUsedTiles=!1,a.defaultName="Unknown",a.name=a.defaultName}),angular.module("NumidiApp").controller("HighScoreController",["$scope","settingsService","highScoreService",function(a,b,c){a.settings=b,a.highScore=c}]),angular.module("NumidiApp").service("highScoreService",["localStorageService",function(a){function b(){var a=c.localStorage.get("version")||0;c.version>a&&(c.localStorage.set("version",c.version),c.results={},c.localStorage.set("highscore",c.results))}var c=this;c.version=1,c.localStorage=a,c.results=c.localStorage.get("highscore")||{},b(),c.addResult=function(a,b,d){c.isHighScore(a,d)&&(c.results[a]={name:b,score:d},c.localStorage.set("highscore",c.results))},c.isHighScore=function(a,b){return null==c.results[a]||b<=c.results[a].score},c.hasScore=function(){return!(0===Object.keys(c.results).length)}}]);