"use strict";angular.module("NumidiApp",["ui","ui.bootstrap","LocalStorageModule"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/home.html"}).when("/board",{controller:"BoardController",templateUrl:"views/board.html"}).when("/settings",{controller:"SettingsController",templateUrl:"views/settings.html"}).when("/highscore",{controller:"HighScoreController",templateUrl:"views/highscore.html"}).when("/rules",{templateUrl:"views/rules.html"}).when("/about",{templateUrl:"views/about.html"}).otherwise({redirectTo:"/board"})}]),angular.module("NumidiApp").controller("NavbarController",["$scope","$location",function(a,b){a.routeIs=function(a){return b.path()===a}}]),angular.module("NumidiApp").controller("BoardController",["$scope","boardService",function(a,b){a.board=b}]),angular.module("NumidiApp").service("boardService",["settingsService","highScoreService",function(a,b){function c(a,b,c){this.number=a,this.coordinate=[],this.coordinate.row=b,this.coordinate.col=c,this.picked=!1,this.solved=!1}function d(a,b){var c={row:a.row,col:a.col};return c.col+=1,c.col==e.settings.width&&(c.col=0,c.row+=1),b&&(c.row>e.lastCoordinate.row||c.row==e.lastCoordinate.row&&c.col>e.lastCoordinate.col)&&(c.row=0,c.col=0),c}var e=this;e.settings=a,e.highScore=b,e.started=!1,e.win=!1,e.grid=[],e.lastCoordinate=[],e.firstPick=void 0,e.resetGame=function(){e.started=!1,e.win=!1,e.grid=[],e.lastCoordinate=[],e.firstPick=void 0},e.newGame=function(){e.resetGame(),e.started=!0,e.grid[0]=[];for(var a=-1,b=0;b<e.settings.width;b++){do var d=Math.floor(10*Math.random());while(a==d||10==a+d);e.grid[0][b]=new c(d,0,b),a=d}e.grid[1]=[];for(var b=0;b<e.settings.width;b++)e.grid[1][b]=new c(b%10,1,b);e.lastCoordinate=[],e.lastCoordinate.row=1,e.lastCoordinate.col=e.settings.width-1},e.pickTile=function(a){function b(){for(var a=0;a<=e.lastCoordinate.row;a++)for(var b=0;b<=(a==e.lastCoordinate.row?e.lastCoordinate.col:e.settings.width-1);b++)if(!e.grid[a][b].solved)return!1;return!0}function c(a,b){return f(a.coordinate,b.coordinate)||f(b.coordinate,a.coordinate)||g(a.coordinate,b.coordinate)||h(a.coordinate,b.coordinate)}function f(a,b){var c=d(a,!0);return c.row==b.row&&c.col==b.col?!0:e.grid[c.row][c.col].solved?f(c,b):!1}function g(a,b){if(a.col!=b.col)return!1;for(var c=Math.min(a.row,b.row)+1;c<Math.max(a.row,b.row);c++)if(!e.grid[c][a.col].solved)return!1;return!0}function h(a,b){if(Math.abs(a.row-b.row)!=Math.abs(a.col-b.col)||a.row==b.row)return!1;var c={row:a.row>b.row?a.row-1:a.row+1,col:a.col>b.col?a.col-1:a.col+1};return c.row==b.row&&c.col==b.col?!0:e.grid[c.row][c.col].solved?h(c,b):!1}a.solved?e.firstPick&&(e.firstPick.picked=!1,e.firstPick=void 0):e.firstPick?e.firstPick===a?(a.picked=!1,e.firstPick=void 0):e.firstPick.number!=a.number&&10!=e.firstPick.number+a.number||!c(e.firstPick,a)?(e.firstPick.picked=!1,a.picked=!0,e.firstPick=a):(e.firstPick.picked=!1,e.firstPick.solved=!0,a.picked=!1,a.solved=!0,e.firstPick=void 0,b()&&(e.win=!0,e.highScore.addScore(e.settings.width,e.lastCoordinate.row*e.settings.width+e.lastCoordinate.col+1))):(a.picked=!0,e.firstPick=a)},e.deal=function(){for(var a={row:e.lastCoordinate.row,col:e.lastCoordinate.col},b=0;b<=a.row;b++)for(var f=0;f<=(b==a.row?a.col:e.settings.width-1);f++)e.grid[b][f].solved||(e.lastCoordinate=d(e.lastCoordinate,!1),0==e.lastCoordinate.col&&(e.grid[e.lastCoordinate.row]=[]),e.grid[e.lastCoordinate.row][e.lastCoordinate.col]=new c(e.grid[b][f].number,e.lastCoordinate.row,e.lastCoordinate.col))}}]),angular.module("NumidiApp").controller("SettingsController",["$scope","settingsService","boardService",function(a,b,c){a.settings=b,a.board=c}]),angular.module("NumidiApp").service("settingsService",function(){var a=this;a.width=20,a.widths=[10,15,20,25,30]}),angular.module("NumidiApp").controller("HighScoreController",["$scope","settingsService","highScoreService",function(a,b,c){a.settings=b,a.highScore=c}]),angular.module("NumidiApp").service("highScoreService",["localStorageService",function(a){var b=this;b.localStorage=a,b.scores=b.localStorage.get("highscore")||{},b.addScore=function(a,c){(null==b.scores[a]||c<b.scores[a])&&(b.scores[a]=c),b.localStorage.set("highscore",b.scores)},b.hasScore=function(){return!(0===Object.keys(b.scores).length)}}]);